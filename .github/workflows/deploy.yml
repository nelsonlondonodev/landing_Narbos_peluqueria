name: Deploy to Hostinger

on:
  push:
    branches:
      - main

jobs:
  web-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest
    steps:
      - name: ğŸšš Get latest code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¦ Install dependencies
        run: npm ci

      - name: ğŸ—ï¸ Build Project
        run: npm run build

      - name: ğŸ“‚ Prepare Deploy Artifact
        # Preparamos una carpeta temporal 'deploy_public' para simular la raÃ­z del servidor
        # Copiamos .htaccess a la raÃ­z y dist/ como subcarpeta
        run: |
          mkdir deploy_public
          cp .htaccess deploy_public/
          cp -r dist deploy_public/

      - name: ğŸš€ Sync with Hostinger (FTP)
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./deploy_public/
          server-dir: ./public_html/
          # CRÃTICO: Excluir la carpeta 'blog' del servidor para no borrarla ni sobrescribirla
          # TambiÃ©n excluimos node_modules o archivos git por seguridad si se colaron
          exclude: |
            **/.git*
            **/.git*/**
            **/node_modules/**
            blog/**
            blog
          # Dangerous options (desactivadas para seguridad inicial)
          # delete: true (ActÃ­valo solo si estÃ¡s seguro de que 'exclude' funciona bien)
