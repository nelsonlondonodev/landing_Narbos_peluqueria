export class HeaderController{constructor(e){this.DOM={header:e||document.querySelector(".site-header")||(document.getElementById("navbar-root")?document.getElementById("navbar-root").parentElement:null),dropdownBtn:document.getElementById("desktop-services-btn"),dropdownMenu:document.getElementById("desktop-services-menu")},this.DOM.header?this.init():(console.warn("HeaderController: Header not found immediately. Retrying in 500ms..."),setTimeout(()=>{this.DOM.header=document.querySelector(".site-header")||(document.getElementById("navbar-root")?document.getElementById("navbar-root").parentElement:null),this.DOM.header?(console.log("HeaderController: Retry successful."),this.init()):console.error("HeaderController: Retry FAILED.")},500))}init(){this.createBackdrop(),this.initScrollEffect(),this.initDropdowns(),this.initScrollSpy()}createBackdrop(){this.backdrop=document.createElement("div"),this.backdrop.id="desktop-menu-backdrop",this.backdrop.className="fixed inset-0 bg-black/60 z-[40] opacity-0 pointer-events-none transition-opacity duration-300",document.body.appendChild(this.backdrop),this.backdrop.addEventListener("click",()=>this.closeDropdown())}initScrollEffect(){if(this.DOM.header||(this.DOM.header=document.querySelector(".site-header")),!this.DOM.header)return void console.error("HeaderController: FATAL - .site-header no encontrado en el DOM tras reintentos.");let e=!1;const t=()=>{e||(window.requestAnimationFrame(()=>{const t=window.scrollY>50;this.DOM.header.classList.toggle("header-scrolled",t),e=!1}),e=!0)};window.addEventListener("scroll",t,{passive:!0}),t()}initDropdowns(){if(!this.DOM.dropdownBtn||!this.DOM.dropdownMenu)return;let e;this.DOM.dropdownBtn.addEventListener("mouseenter",()=>{clearTimeout(e),this.openDropdown()}),this.DOM.dropdownMenu.addEventListener("mouseenter",()=>{clearTimeout(e)}),this.DOM.dropdownBtn.addEventListener("mouseleave",()=>{e=setTimeout(()=>this.closeDropdown(),300)}),this.DOM.dropdownMenu.addEventListener("mouseleave",()=>{e=setTimeout(()=>this.closeDropdown(),300)}),this.DOM.dropdownBtn.addEventListener("click",e=>{e.stopPropagation(),this.toggleDropdown()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.closeDropdown()})}toggleDropdown(){this.DOM.dropdownMenu.classList.contains("hidden")?this.openDropdown():this.closeDropdown()}openDropdown(){this.DOM.dropdownMenu.classList.contains("hidden")&&(this.DOM.dropdownMenu.classList.remove("hidden"),this.DOM.dropdownBtn.setAttribute("aria-expanded","true"),this.backdrop&&this.backdrop.classList.remove("pointer-events-none","opacity-0"))}closeDropdown(){this.DOM.dropdownMenu.classList.contains("hidden")||(this.DOM.dropdownMenu.classList.add("hidden"),this.DOM.dropdownBtn.setAttribute("aria-expanded","false"),this.backdrop&&this.backdrop.classList.add("opacity-0","pointer-events-none"))}isClickInsideDropdown(e){return this.DOM.dropdownBtn.contains(e)||this.DOM.dropdownMenu.contains(e)}initScrollSpy(){const e=document.querySelectorAll("main section[id], footer[id]"),t=document.querySelectorAll("header nav .desktop-menu a");if(0===e.length||0===t.length)return;const o=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&this.updateActiveLink(t,e.target.id)})},{root:null,rootMargin:"-20% 0px -60% 0px",threshold:0});e.forEach(e=>o.observe(e))}updateActiveLink(e,t){e.forEach(e=>e.classList.remove("nav-link-active"));const o=document.querySelector(`header nav .desktop-menu a[href*="${t}"]`);o&&o.classList.add("nav-link-active")}}