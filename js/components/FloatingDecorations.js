import{BASE_PATH}from"../config.js";export class FloatingDecorations{constructor(e={}){this.config={basePath:e.basePath||BASE_PATH,enableAnimation:!1!==e.enableAnimation,customConfig:e.customConfig||null},this.basePath=this.config.basePath,this.basePath&&!this.basePath.endsWith("/")?this.basePath+="/":this.basePath||(this.basePath=""),this.leaves=[],this.init()}init(){const e=window.matchMedia("(prefers-reduced-motion: reduce)").matches;this.injectDecorations(),this.config.enableAnimation&&!e&&this.startParallaxLoop()}injectDecorations(){this.getConfigs().forEach(e=>{try{const t=document.getElementById(e.parent);if(!t)return;const a=t.querySelectorAll(".floating-decoration-leaf");let s=!1;if(a.forEach(t=>{t.src.includes(e.img)&&(s=!0)}),s)return;this.setupParentSection(t);const i=this.createLeafElement(e);this.config.enableAnimation&&e.speed>0&&this.registerForParallax(i,e),t.prepend(i),this.adjustZIndices(t,i,e)}catch(t){console.warn(`FloatingDecorations: Failed to inject leaf for ${e.parent}`,t)}})}getConfigs(){if(this.config.customConfig)return this.config.customConfig;const e=window.location.pathname;if(e.includes("/blog"))return[];const t="/"===e||e.endsWith("index.html")&&!e.includes("/servicios/"),a=e.includes("/peluqueria"),s=e.includes("/barberia"),i=e.includes("/estetica"),o=e.includes("/unas-spa"),r=a||s||i||o;let n=[];if(t){n=[{parent:"inicio",img:"ui/decorations/hoja-seca-3d.webp",speed:.25,wrapperClasses:"-left-6 top-[10%] md:left-[-2%] z-10",imgClasses:"w-20 md:w-44 rotate-45 opacity-90 md:opacity-100 animate-leaf-enter-left"},{parent:"inicio",img:"ui/decorations/hoja-verde-3d.webp",speed:.35,wrapperClasses:"-right-6 top-[40%] md:right-[15%] md:top-[35%] z-10",imgClasses:"w-24 md:w-56 -rotate-12 opacity-90 md:opacity-100 animate-leaf-enter-right"},{parent:"servicios",img:"ui/decorations/hoja-seca-3d.webp",speed:.2,wrapperClasses:"-right-2 top-24 md:-right-20 md:top-12 z-20",imgClasses:"w-24 md:w-48 animate-leaf-enter-right"},{parent:"servicios",img:"ui/decorations/hoja-verde-3d.webp",speed:.3,wrapperClasses:"-left-4 top-1/2 md:-left-12 md:top-[40%] z-20",imgClasses:"w-28 md:w-40 animate-leaf-enter-left"}];const e=[{parent:"faq",img:"ui/decorations/hoja-seca-3d.webp",speed:.15,wrapperClasses:"-left-8 -top-10 md:left-2 md:top-2 z-20",imgClasses:"w-24 md:w-32 -rotate-45 md:rotate-10 animate-leaf-enter-left"}];return[...n,...e]}return n=r?[{parent:"inicio",img:"ui/decorations/hoja-seca-3d.webp",speed:0,wrapperClasses:"-right-4 top-12 md:-right-12 md:top-20 z-30",imgClasses:"w-24 md:w-56 rotate-[15deg] animate-leaf-enter-right"},{parent:"inicio",img:"ui/decorations/hoja-verde-3d.webp",speed:0,wrapperClasses:"-left-6 top-3/4 md:-left-16 md:bottom-20 z-30",imgClasses:"w-28 md:w-48 -rotate-[15deg] animate-leaf-enter-left"}]:[{parent:"inicio",img:"ui/decorations/hoja-seca-3d.webp",speed:0,wrapperClasses:"-right-4 top-12 md:-right-12 md:top-20 z-30",imgClasses:"w-24 md:w-40 rotate-[15deg] opacity-90"},{parent:"inicio",img:"ui/decorations/hoja-verde-3d.webp",speed:0,wrapperClasses:"-left-6 top-3/4 md:-left-8 md:top-[60%] z-30",imgClasses:"w-28 md:w-36 -rotate-[15deg] opacity-90"}],n}setupParentSection(e){"static"===window.getComputedStyle(e).position&&e.classList.add("relative")}createLeafElement(e){const t=document.createElement("div");t.className=`floating-decoration-wrapper absolute pointer-events-none will-change-transform ${e.wrapperClasses}`;const a=document.createElement("img");return a.src=`${this.basePath}images/${e.img}`,a.onerror=()=>{t.style.display="none"},a.alt="",a.className=`floating-decoration-leaf block drop-shadow-2xl transition-transform duration-700 ease-out ${e.imgClasses}`,t.appendChild(a),t._parallaxTarget=t,t}registerForParallax(e,t){e.setAttribute("data-speed",t.speed),this.leaves.push({element:e,speed:t.speed})}adjustZIndices(e,t,a){e.children.length>0&&Array.from(e.children).forEach(e=>{if(e!==t&&1===e.nodeType){"static"===window.getComputedStyle(e).position&&e.classList.add("relative"),a.wrapperClasses.includes("z-10")||e.classList.add("z-10")}})}startParallaxLoop(){const e=()=>{const t=window.scrollY;this.leaves.forEach(e=>{const a=t*e.speed;e.element.style.transform=`translateY(${a}px)`}),requestAnimationFrame(e)};requestAnimationFrame(e)}}