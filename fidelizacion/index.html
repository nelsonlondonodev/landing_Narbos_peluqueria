<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club de Fidelización | Narbo's Salón Spa</title>
    <!-- No indexar para uso exclusivo en el salón -->
    <meta name="robots" content="noindex, nofollow">
    
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="icon" type="image/webp" href="../images/brand/favicon_narbos.webp" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <style>
        .fidelizacion-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(197, 171, 148, 0.3);
        }
        .form-input {
            border-bottom: 2px solid #C5AB94;
            transition: border-color 0.3s ease;
        }
        .form-input:focus {
            outline: none;
            border-bottom-color: #6B755A;
        }
    </style>
</head>
<body class="bg-brand-light/20 font-sans min-h-screen flex flex-col">
    <!-- Header Minimalista -->
    <header class="py-6 px-10 flex justify-center">
        <a href="../">
            <img src="../images/brand/logo_narbos_dorado.webp" alt="Logo Narbo's" class="h-10 md:h-12">
        </a>
    </header>

    <main class="flex-grow flex items-center justify-center px-6 py-12">
        <div class="fidelizacion-card max-w-lg w-full p-8 md:p-12 rounded-3xl shadow-2xl animate__animated animate__fadeInUp">
            <div class="text-center mb-10">
                <h1 class="text-3xl md:text-4xl font-serif font-bold text-brand-gray-dark mb-4">Bienvenida al Club Narbo's</h1>
                <p class="text-brand-gray-dark/70">Regístrate hoy y recibe un beneficio exclusivo en tu próxima visita.</p>
            </div>

            <form id="fidelizacion-form" class="space-y-6">
                <div>
                    <label for="name" class="block text-sm font-bold text-brand-green uppercase tracking-wider mb-2">Nombre Completo</label>
                    <input type="text" id="name" name="name" required class="w-full bg-transparent p-3 form-input" placeholder="Tu nombre...">
                </div>

                <div>
                    <label for="email" class="block text-sm font-bold text-brand-green uppercase tracking-wider mb-2">Correo Electrónico</label>
                    <input type="email" id="email" name="email" required class="w-full bg-transparent p-3 form-input" placeholder="ejemplo@correo.com">
                </div>

                <div>
                    <label for="whatsapp" class="block text-sm font-bold text-brand-green uppercase tracking-wider mb-2">WhatsApp</label>
                    <input type="tel" id="whatsapp" name="whatsapp" required class="w-full bg-transparent p-3 form-input" placeholder="+57 300 000 0000">
                </div>

                <div class="pt-4">
                    <button type="submit" id="submit-btn" class="w-full bg-brand-green text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-brand-gray-dark transition-all transform hover:-translate-y-1">
                        Obtener mi Descuento
                    </button>
                </div>
            </form>

            <!-- Mensaje de éxito (Oculto) -->
            <div id="success-msg" class="hidden text-center py-8 animate__animated animate__zoomIn">
                <div class="bg-brand-green/10 p-6 rounded-2xl mb-6">
                    <svg class="w-16 h-16 text-brand-green mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <h2 class="text-2xl font-serif font-bold text-brand-gray-dark mb-2">¡Registro Exitoso!</h2>
                    <p class="text-brand-gray-dark/70">Revisa tu correo electrónico para descargar tu código QR personalizado.</p>
                </div>
                <p class="text-sm font-medium text-brand-gray-dark italic">"Nos vemos pronto en tu próxima experiencia Narbo's"</p>
            </div>
        </div>
    </main>

    <footer class="py-6 text-center text-brand-gray-dark/40 text-xs">
        &copy; 2026 Narbo's Salón Spa. Todos los derechos reservados.
    </footer>

    <script type="module">
        const form = document.getElementById('fidelizacion-form');
        const successMsg = document.getElementById('success-msg');
        const submitBtn = document.getElementById('submit-btn');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            submitBtn.disabled = true;
            submitBtn.innerHTML = 'Procesando...';

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            try {
                // Sincronizar con n8n
                const response = await fetch('https://n8n.srv1033442.hstgr.cloud/webhook/fidelizacion-captacion', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ...data,
                        source: 'Fidelizacion Page',
                        timestamp: new Date().toISOString()
                    })
                });

                if (response.ok) {
                    form.classList.add('hidden');
                    successMsg.classList.remove('hidden');
                } else {
                    alert('Hubo un error al procesar tu registro. Por favor, intenta de nuevo.');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = 'Obtener mi Descuento';
                }
            } catch (error) {
                console.error('Error:', error);
                alert('No se pudo establecer conexión con el servidor. Verifica tu internet.');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Obtener mi Descuento';
            }
        });
    </script>
</body>
</html>
